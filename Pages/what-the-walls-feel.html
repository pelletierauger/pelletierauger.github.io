<!-- sketch -->/what-the-walls-feel/sketch.js
<!-- fr-title -->Ce que ressentent les murs
<!-- fr-html-title -->Ce <span class="italic8"><span class="small-title">que</span></span> ressentent <span class="italic8"><span class="small-title">les</span></span>&nbsp;murs
<!-- fr-date -->Été 2020
<!-- fr-description -->Un vidéoclip pour le compositeur Frank&nbsp;Horvat.
<!-- fr-content -->
<img src="../../../images/what-the-walls-feel/plants-softer.jpg">
<p class="article-top">
    <sc>En octobre 2019</sc>, le compositeur torontois <a href="http://frankhorvat.com/">Frank Horvat</a> a publié un album de musique de chambre &nbsn;minimaliste<snl label="around">L'album s'institule <i8>What Goes Around</i8> et <a href="http://frankhorvat.com/discography/what-goes-around/">vous pouvez l'écouter</a> sur son site Web. C'est de l'excellente musique que je recommande fortement.</snl> et a ensuite décidé d'engager des cinéastes pour transformer chacune des pistes de l'album en court métrage expérimental. Le projet comprend présentement le travail des animatrices montréalaises <a href="https://moiajp.net/">Moïa Jobin-Paré</a> et <a href="http://www.sunnystanila.com/">Sunny Stanila</a>, de l'artiste torontois <a href="http://www.matthewmaaskant.com/">Matthew Maaskant</a>, et le mien.
</p>
<p>
    Vous pouvez <a href="https://www.youtube.com/user/frankhorvatofficial/">regarder mon vidéoclip</a> sur la chaîne YouTube de Frank. Il a été créé avec des logiciels libres et conçus expressément pour cette production. Le code écrit pour réaliser le vidéoclip est également distribué en code source libre, vous pouvez <a href="https://github.com/pelletierauger/what-the-walls-feel">le trouver ici</a>.
</p>

<h3>Mise en images d'une musique minimaliste</h3>

<pn>
    <sc>La piste de l'album</sc> avec laquelle j'ai choisi de travailler est un morceau mélancolique pour six clarinettes, intitulé <i>What the Walls Feel as they Stare at Rob Ford Sitting in his &nbsn;Office</i><snr label="programme">Dans les <a href="http://frankhorvat.com/composition/what-walls-feel-as-they-stare-at-rob-ford-sitting-in-his-office/">notes qui accompagnent le morceau</a>, Frank explique (en anglais) comment lui est venu ce titre hors du commun.</snr> (&#171;&nbsp;<i>Ce que ressentent les murs en regardant Rob Ford assis dans son bureau</i>&nbsp;&#187;). Le morceau est composé dans le style minimaliste, et conséquemment il présente de lentes transformations de motifs répétés, introduisant de nouvelles variations musicales à l'intérieur de balises très restreintes. Comme la plupart des pièces minimalistes, le morceau possède aussi très peu de variations dynamiques (très peu d'écart entre les sons les plus forts et les sons les plus doux), et il submerge plutôt les auditeur&middot;trice&middot;s dans une riche séquence de variations microscopiques.
</pn>
<p>
    J'adore la musique minimaliste, ayant passé un nombre d'heures incalculable avec les &oelig;uvres de géants du genre tels que Steve Reich, Meredith Monk et Julius Eastman, alors l'idée de traduire visuellement une telle musique m'a immédiatement semblée très excitante. Il m'a aussi semblé clair que l'animation géométrique et algorithmique était l'outil idéal pour représenter graphiquement cette idée des variations microscopiques à l'intérieur de balises restreintes. La musique minimaliste est fortement associée à la <a href="https://en.wikipedia.org/wiki/Process_music"><i>process music</i></a> (&#171;&nbsp;musique de processus&nbsp;&#187;), que Steve Reich a décrit ainsi : &#171;&nbsp;des pièces musicales qui sont littéralement des processus&nbsp;&#187;. Dans le domaine de l'art algorithmique, tout est un processus &mdash; un algorithme étant simplement une liste d'instructions à suivre qui définit un processus. L'art algorithmique est ainsi souvent appellé <i>art procédural</i>.
</p>
<p>
    Les pochettes de certains albums minimalistes importants, tels que <a href="https://en.wikipedia.org/wiki/Music_for_18_Musicians"><i>Music for 18 Musicians</i></a> et <i>Drumming</i> de Steve Reich et <i>Two Solo Pieces</i> de Jon Gibson, sont faites de denses motifs géométriques et offrent aussi de bons exemples de cette connivence conceptuelle entre la musique minimaliste et l'art algorithmique.
</p>

<h3>Recherche d'un système visuel</h3>

<pn>
    <sc>Il s'agit</sc> de ma deuxième expérience de réalisation d'animations algorithmiques dans le cadre d'une commande. La première fois, ce fut pour un <a href="https://www.youtube.com/watch?v=PFufr93KNoQ">vidéoclip</a> réalisé par <a href="https://pascalinelefebvre.tumblr.com/">Pascaline Lefebvre</a>, une illustratrice, autrice, designer et cinéaste montréalaise. La plus grande part de l'animation qui se trouve dans le vidéoclip a été dessinée à la main par Pascaline, et j'ai contribué en animant des volées d'oiseaux qui apparaissent dans certaines &nbsn;scènes.<snl label="flocks">Les voilées d'oiseaux étaient animées grâce à des algorithmes qui simulent le comportement d'oiseaux en vol. Ces algorithmes étaient inspirés de ceux dont Daniel Shiffman traite dans plusieurs de ses vidéos. Tout le code écrit pour ce projet <a href="https://github.com/pelletierauger/Oiseaux">peut être consulté ici</a>.</snl>
</pn>
<p>
    Cette fois-ci, j'ai entamé ma recherche visuelle en écoutant à répétition le morceau de Frank et en esquissant de nombreuses idées avec le logiciel <lnum><a href="https://p5js.org/">p5.js</a></lnum>. J'ai éventuellement eu une idée qui m'a semblé avoir un lien fort avec le morceau : un mur de petits points qui se meuvent en différentes chorégraphies et qui forment un ensemble de motifs complexes.
</p>
<p>
    J'ai esquissé un prototype de cette idée avec <a href="https://editor.p5js.org/">l'éditeur Web <lnum>p5</lnum>.js</a>. Le &nbsn;voici :<snr label="prototype">Vous pouvez aussi voir <a href="https://editor.p5js.org/guillaume/sketches/ej_9eAWxI">cette esquisse juxtaposée au code qui la génère</a> dans l'éditeur Web <lnum>p5</lnum>.js. L'éditeur vous permet de modifier n'importe quel élément de l'esquisse et de voir les résultats immédiatement.</snr>
</p>

<div id="dot-grid-demo"></div>

<pn>
    Le mur était un bon ancrage visuel pour tout le film, considérant le titre du morceau. Même si les points se meuvent par oscillations douces et harmonieuses, ils restent pourtant attachés à une grille rigide que l'on perçoit bien visuellement. J'ai bien aimé la tension qui se crée entre ces deux phénomènes, et j'ai trouvé qu'elle traduisait bien la tension qui se ressent dans la musique. Les murs ruminent, se contorsionnent de diverses manières en réfléchissant à ce qu'ils observent.
</pn>

<h3>Création de logiciels</h3>

<pn>
    <sc>Le film</sc> a été réalisé entièrement par l'écriture de logiciels conçus expressément pour ce projet. Le film lui-même est un programme &mdash; lorsque ce programme est exécuté, il peut soit jouer le film en exporter les images finales sur le disque dur. Le film est distribué avec une licence de logiciel libre, et vous pouvez <a href="https://github.com/pelletierauger/what-the-walls-feel">en trouver le code ici</a>. Vous êtes libres de consulter ce code, de le modifier et d'en distribuer des copies modifiées. Mon travail était aussi grandement inspiré du logiciel <lnum><a href="https://p5js.org/">p5.js</a></lnum>, créé par <a href="https://lauren-mccarthy.com/">Lauren McCarthy</a> et son équipe.
</pn>
<p>
    Pour écrire le film, j'ai également utilisé un autre logiciel que je suis en train d'écrire, qui s'appelle Les &nbsn;environs.<snl label="environs">Les environs est également distribué avec une licence en code source libre. Vous pouvez <a href="https://github.com/pelletierauger/Les-environs">télécharger ce logiciel ici</a>.</snl> Les environs est un environnement de programmation &ldquo;à la volée&rdquo; ou programmation <i>in vivo</i> (de l'anglais <i>live coding</i>) &mdash; il permet d'écrire et de modifier un programme pendant même son exécution. J'ai d'abord développé ce logiciel pour la performance en direct d'animation et de musique, et m'en suis servi lors de quelques concerts dans des salles de spectacles à Montréal en 2019. Adapter cet outil de performance aux besoins d'une production de film était un défi très intéressant. Je me suis retrouvé à construire différents modules pour couvrir toutes les étapes de la production : l'animation, le montage, la coloration, le compositing et le rendu.
</p>
<p>
    Vous pouvez voir ci-dessous à quoi ressemble le logiciel lorsque je suis en train de travailler sur le film.
</p>

<img class="full-size-image" src="../../../images/what-the-walls-feel/environment.jpg">

<pn>
    Le cadre du film couvre presque tout l'écran, et une part du code y est superposée (le code peut aisément être dissimulé afin de révéler l'image complète). En bas à droite se trouve la ligne du temps, où toutes les scènes sont représentées par des rectangles alternativement blancs ou gris. Tout en bas se trouvent les onglets, qui permettent d'afficher différentes sections du code (le code est séparé en de multiples fichiers). Le code peut être modifié alors même que le film joue, et tout changement est immédiatement appliqué et visible. Par exemple, alors que la ligne du temps est représentée visuellement, elle ne peut être modifiée que dans le code, et lorsque la durée d'une scène est changée dans le code, la ligne du temps visuelle est aussitôt mise à jour. Il est aussi possible d'afficher à plus grande échelle une toute petite section de la ligne du temps, afin de faire un travail de montage plus précis.
</pn>

<h3>Coloration</h3>

<pn>
    <sc>Une des plus importantes</sc> améliorations que j'ai faites à mon logiciel d'animation dans le cadre de ce projet a été de rendre possible le mélange de multiples calques d'image en utilisant les diverses &ldquo;fonctions de mélange&rdquo; (<i>blending functions</i>) que l'on retrouve normalement dans Photoshop et After Effects (multiplication, addition, lumière douce, &nbsn;etc.).<snl label="filter-graph">Plus précisément, mon système ne repose pas sur des piles linéaires de calques comme le font Photoshop et After Effects. Il permet plutôt des graphes non linéaires de calques, ou des <i8>réseaux de calques</i8>. Pour la petite histoire: la première fois que j'ai assemblé un film d'animation, j'utilisais un logiciel aujourd'hui très obsolète : USAnimation, par Toon Boom. Dans <a href="https://www.awn.com/animationworld/usanimation-action">cet article d&rsquo;<sc8>awn</sc8> datant de 2001</a>, on peut voir une image du module &ldquo;Camera&rdquo; de USAnimation et l'on voit bien qu'il reposait sur cette idée très puissante des graphes de calques. Après avoir passé de USAnimation à After Effects il y a déjà longtemps, je me suis toujours senti très limité par le système des piles linéaires de calques d'After Effects. C'est un grand plaisir de retourner aux graphes après tout ce temps.</snl> J'ai trouvé une réplique de ces fonctions de mélange dans cette <a href="https://mouaif.wordpress.com/2009/01/05/photoshop-math-with-glsl-shaders/">excellente note de blog datant de 2009</a>, et comme ces fonctions sont distribuées en code source libre, il m'a été possible de les intégrer à mon système. Mon système de calques n'existe présentement pas sous aucune forme visuelle (il ne m'est pas possible de vous le montrer), alors la combinaison des calques se fait uniquement par l'écriture de code, et ce faisant il faut imaginer l'ordre des calques dans sa tête avant de voir apparaître les résulats.
</pn>
<p>
    Ce système de calques amélioré m'a été d'une grande utilité lors de la coloration du film. Je me suis retrouvé à faire beaucoup de recherches de coloration qui m'ont amené sur de nombreuses pistes très divergentes. Vous pouvez voir ci-dessous certains exemples des images générées lors de ces recherches. Mes recherches m'amenaient souvent vers des palettes de couleurs très vives et joyeuses, mais celles-ci ne fonctionnent pas du tout avec l'ambiance du morceau musical. La musique avait besoin d'une palette plus sombre, plus réservée, un peu triste.
</p>
<p>
    J'ai aussi fait beaucoup d'expériences de transitions de couleurs entre les scènes du film, mais ces transitions ne fonctionnaient pas non plus. La couleur musicale du morceau de Frank est tellement stable et trouve tant de sa force et de son caractère dans cette constance presque entêtée, que tout changement des couleurs semblait venir de nulle part &mdash; l'image semblait dériver soudainement sur un chemin différent, s'éloignant de la musique. Les transitions de couleurs donnaient aussi l'impression que j'essayais simplement d'introduire à tout prix toutes les palettes que j'avais créées dans le cadre de mes recherches, ce qui était effectivement le cas.
</p>

<img class="full-size-image" src="../../../images/what-the-walls-feel/spicy-lemon-a.jpg">
<img class="full-size-image" src="../../../images/what-the-walls-feel/spicy-lemon-b.jpg">
<img class="full-size-image" src="../../../images/what-the-walls-feel/mustard.jpg">
<img class="full-size-image" src="../../../images/what-the-walls-feel/red-and-blue.jpg">
<img class="full-size-image" src="../../../images/what-the-walls-feel/mustard-muscles.jpg">

<h3>Les principes mathématiques du film</h3>

<pn>
    <sc>Le système</sc> mathématique sur lequel le film entier est construit est une grille à deux dimensions, avec un axe horizontal <im>x</im> et un axe vertical <im>y</im>. Dans chaque cellule de cette grille se trouve un point, qui possède ses propres coordonnées <im>x</im> et <im>y</im>. Par exemple, le point au coin supérieur gauche de la grille a la position <im>x = 0, y = 0</im>.
</pn>

<img class="inline-image" src="../../../images/what-the-walls-feel/grid.png">

<pn>
    Chaque point de la grille est ensuite capable de se mouvoir dans l'espace. Sa position initiale dans l'espace est définie par les coordonnées <im>x</im> et <im>y</im> de la cellule dans lequel il se trouve. Et puis, la position finale <im>p</im> du point est calculée par l'application d'une transformation mathématique, qui est, pour la plupart du temps, une équation paramétrique. Par exemple, voici la transformation qui est appliquée dans l'animation qui se trouve plus haut dans cet article.
</pn>

<math>
\begin{align*}
    m   &= x \cdot y \cdot 10^{-3} + t\\
    p_x &= x + \cos(m)\\
    p_y &= y + \sin(m)
\end{align*}
</math>

<pn>
    Une copie identique de cette équation est envoyée à chacun des points de la grille, mais puisque chaque point a des coordonnées <im>x</im> et <im>y</im> différentes à l'intérieur de la grille, le résultat de l'équation est légèrement différent pour chaque point. Cette équation a trois variables d'entrée : <im>x</im>, <im>y</im> et <im>t</im>. Les variables <im>x</im> et <im>y</im> sont simplement la position que le point occupe dans la grille. La troisième variable, <im>t</im>, représente le <i>temps</i>. C'est une variable dont la valeur est d'abord <im>0</im>, puis elle est incrémentée à chaque nouvelle image de &nbsn;l'animation.<snr label="increment">Dans ce cas-ci, elle est incrémentée de <im>\pi / 60</im>. Cette valeur implique que la fonction se répétera à toutes les <im>120</im> images, puisque les fonctions sinus et cosinus se répètent sur <im>2\pi</im>.</snr>Puisque la variable <im>t</im> représente le temps, elle représente aussi la vitesse à laquelle les points se meuvent &mdash; plus la valeur <im>t</im> est grande, plus la vitesse est grande. La variable <im>t</im> est la même pour chaque point ; le temps avance à la musique vitesse pour tous les points.
</pn>
<p>
    Une fois que cette formule est calculée pour chaque point, les valeurs <im>p_x</im> and <im>p_y</im> de chaque point détermine sa position exacte dans l'espace. Un point a aussi la liberté de s'envoler à l'extérieur de la cellule qu'il occupe dans la grille &mdash; cette cellule ne sert qu'à donner au point sa position intiale, et non pas à restreindre ses mouvements.
</p>

<h3>Variations infinies</h3>

<pn>
    <sc>Ce que j'ai tout de suite aimé</sc> dans ce système lorsque j'ai commencé à l'explorer, c'était l'évidente infinité des variations qu'il pouvait produire. En changeant chaque paramètre de la transformation mathématique, et aussi en écrivant de toutes nouvelles transformations, je pouvais obtenir une quantité infinie de chorégraphies de points.
</pn>
<p>
    Par exemple, l'équation ci-dessous m'a donné une grande surprise. L'animation qui en résulte ne ressemble plus à un motif d'oscillation harmonieuse (malgré qu'elle en soit un). Elle ressemble plutôt au résultat d'un algorithme qui opère sur la grille.
</p>

<!-- let xx = x + pow(cos(y * 0.5 + t * 0.025), 700) * y * x * 200.5; -->
<!-- let yy = y + pow(sin(x * 0.5 + t * 0.025), 700) * y * x * 200.5; -->

<math>
\begin{align*}
    m   &= x \cdot y \cdot 200.5\\
    p_x &= x + m \cdot \cos\bigg(\frac{y}{2} + \frac{t}{40}\bigg)^{700}\\
    p_y &= y + m \cdot \sin\bigg(\frac{x}{2} + \frac{t}{40}\bigg)^{700}
\end{align*}
</math>

<pn>
    Cette équation est utilisée pour la scène d'ouverture du vidéoclip, dans laquelle les points se meuvent en lignes droites, comme des automobiles coincées dans un embouteillage.
</pn>

<h3>En conclusion</h3>

<pn>
    <sc>Répondre à la musique</sc> de Frank avec mes animations fut un projet très inspirant. J'ai aussi grandement apprécié cette l'opportunité de continuer à construire mes outils logiciels d'animation. Les résultats que j'ai obtenus sont au final très différents de tout ce que je pouvais imaginer au départ. Il y a encore des millions de façons par lesquelles mon système pourrait être amélioré pour des productions futures. J'espère avoir l'opportunité de continuer ce travail.
</pn>


<!-- en-title -->What the Walls Feel
<!-- en-html-title -->What <span class="italic8"><span class="small-title">the</span></span> Walls Feel
<!-- en-date -->Summer 2020
<!-- en-description -->A music video for composer Frank Horvat.
<!-- en-content -->

<img src="../../../images/what-the-walls-feel/plants-softer.jpg">
<p class="article-top">
    <sc>In the fall of 2019</sc>, Toronto composer <a href="http://frankhorvat.com/">Frank Horvat</a> published an album of minimalist chamber &nbsn;music<snl label="around">The album is titled <i8>What Goes Around</i8> and <a href="http://frankhorvat.com/discography/what-goes-around/">you can stream it</a> on his website. Do check it out, it is wonderful music.</snl> and decided to hire filmmakers to transform each album track into a short experimental video. This ongoing project now features the work of fellow Montreal animators <a href="https://moiajp.net/">Moïa Jobin-Paré</a> and <a href="http://www.sunnystanila.com/">Sunny Stanila</a>, Toronto artist <a href="http://www.matthewmaaskant.com/">Matthew Maaskant</a>, and me.
</p>
<p>
    You can <a href="https://www.youtube.com/user/frankhorvatofficial/">watch my video</a> on Frank’s YouTube channel. It is made entirely using free, open source, and custom-made software, and all the code written to create the video is also distributed as free software. You can <a href="https://github.com/pelletierauger/what-the-walls-feel">find the code here</a>.
</p>

<h3>Visualizing musical minimalism</h3>

<!-- <pn>
    <sc>This sorrowful piece</sc> and its evocative title seemed perfectly suited for an abstract, geometric film. In my mind, witnessing the <i>feelings of walls</i> must be a puzzling experience similar to trying to decipher messages emerging out of the waters of Stanisław Lem’s Solaris. It must be an encounter with a different <i>kind</i> of feelings—one for which we do not have references or clear pathways of understanding. Frank Horvat’s intricate musical phrases trace the contours of what the walls feel but they never reveal what those feelings are. The intricate sequencing of fluctuating geometric patterns. these walls without a of Walls often feature repetitive geometric patterns, and I immediately got excited thinking about how I could make patterns that respond to the music.
</pn> -->
<pn>
    <sc>The album track</sc> I found most inspiring for my video was a melancholy piece for six clarinets titled <i>What the Walls Feel as they Stare at Rob Ford Sitting in his &nbsn;Office</i>.<snr label="programme">In his <a href="http://frankhorvat.com/composition/what-walls-feel-as-they-stare-at-rob-ford-sitting-in-his-office/">programme notes</a> for the piece, Frank explains the inspiration behind this peculiar title.</snr> It’s in the style of musical minimalism, so it’s built on the slow transformation of repeated patterns&mdash;introducing new variations within carefully restricted bounds. Like most minimalist pieces, it also doesn’t feature a lot of dynamics (contrasts between quiet and loud parts), and instead immerses the listener in a rich sequence of microscopic changes.
</pn>
<p>
    I’m a lover of musical minimalism, having listened to some of its luminaries like Steve Reich, Meredith Monk, and Julius Eastman, for countless hours, so the task of responding to this music with images was an exciting one. It was also clear that geometric and algorithmic animation was the perfect tool to visually recreate the idea of tiny variations within restricted bounds. Minimalist music is strongly connected to <a href="https://en.wikipedia.org/wiki/Process_music">process music</a>, which Steve Reich defines as &ldquo;pieces of music that are, literally, processes&rdquo;. In the domain of algorithmic art, everything is a process&mdash;algorithms are simply sets of instructions that define processes. Algorithmic art is thus often refered to as <i>procedural art</i>, and the software Processing is one of the most important tool in the field.
    <!-- My work for this project uses <lnum><a href="https://p5js.org/">p5.js</a></lnum>, a JavaScript reimagining of Processing. -->
</p>
<p>
    The cover art for some important minimalist albums like Steve Reich’s <a href="https://en.wikipedia.org/wiki/Music_for_18_Musicians"><i>Music for 18 Musicians</i></a> and <i>Drumming</i>, and Jon Gibson’s <i>Two Solo Pieces</i>, which all feature dense geometric patterns, also exemplify this connection.
</p>
<!-- <ul class="dash">
    <li>
        The sheer lenght of the piece. It's 9 minutes and 2 seconds long, by far the longest abstract film that I ever worked on. Since repetition is one of minimalism's core techniques, it tends to work best when it is considerably stretched over time.
    </li>
    <li>
        The homogeneity and lack of dynamics (contrasts between quiet and loud parts) of the piece. Minimalism revels in tiny changes, in subtle variations of repeated material, and as such it typically doesn't feature a lot of dynamics. So not only would the video be quite <i>long</i>, but it also couldn’t rely on big dramatic changes to sustain interest. Any big surprises would be at odds with the music, where a droning, self-similar feel is maintained throughout.
    </li>
</ul>
<pn>
    So I got very curious about how this could be achieved; how would I sustain interest over a long period of time without relying on fireworks. The answer, of course, is in minimalism itself: tiny, intricate changes within a restricted system of boundaries.
</pn> -->
<!-- <pn>
    One of the challenges that I forsaw with this project was the sheer lenght of the musical piece&mdash;it's 9 minutes and 2 seconds long, by far the longest abstract film that I ever worked on. And also, over the course of whole piece, there is a very strong homogeneity in the musical material. The colour, tonality and timbre of the whole piece remains very homogenous throught its duration. There is a subtle build up of the emotion of the piece as it goes, but the build up is subtle. So I knew that I coudn't rely on dramatic changes in the visuals to sustain interest. I knew that following this minimalist piece of music would require similar minimalist means in the image: intricate variations on similar elements.
</pn> -->
<!-- <p>
    So I knew that I had to produce a <i>lot</i> of material, and that this material needed to resemble itself&mdash;with &nbsn;variations.<snr label="reich">But on another level, of course, I knew that algorithmic animation was the perfect tool for the job&mdash;the cover album for the original 1978 recording of Steve Reich's <a href="https://en.wikipedia.org/wiki/Music_for_18_Musicians"><i8>Music for 18 Musicians</i8></a> demonstrates well how intricate and geometric patterns are a great way to visualize minimalist music.</snr>
</p> -->
<!-- <p>
    But on another level, of course, I knew that algorithmic animation was the perfect tool for the job&mdash;the cover album for the original 1978 recording of Steve Reich's <a href="https://en.wikipedia.org/wiki/Music_for_18_Musicians"><i>Music for 18 Musicians</i></a> demonstrates well how intricate and geometric patterns are a great way to visualize minimalist music.
</p> -->

<h3>Searching for a visual system</h3>

<pn>
    <sc>It's my second time</sc> doing commission animation work using algorithmic art. The first time was for a <a href="https://www.youtube.com/watch?v=PFufr93KNoQ">music video</a> directed by <a href="https://pascalinelefebvre.tumblr.com/">Pascaline Lefebvre</a>, an illustrator, author, and filmmaker from Montréal. Most of the animation in the video was hand-drawn by Pascaline, and I contributed by animating the flocks of birds that you can see during a few moments in the &nbsn;video.<snl label="flocks">The flocking algorithms that I used for this video were inspired by Daniel Shiffman's videos on the subject. All the code I wrote for this project <a href="https://github.com/pelletierauger/Oiseaux">can be found here</a>.</snl>
</pn>


<!--     I got this idea that the main process that creates the movements in the film should be simple mathematical formulas. I generally find that simple mathematical formulas are a great way to generate a large amount of variations&mdash;something that I find perhaps more challenging when a very complicated algorithm is in charge of the animation (but of the course the boundaries between any &ldquo;domains&rdquo; of algorithmic animation are very blurry, as a complicated algorithm can evidently include some simple mathematical formulas which can then be modified at will to create endless variations). -->

<p>
    This time around, I listened to Frank's music a lot while sketching an assortment of ideas. I eventually had an idea that I found very fitting for the music: a wall of small dots moving in different choreographies, forming into a series of intricate patterns.
</p>
<p>
    I sketched out a prototype using the <a href="https://editor.p5js.org/"><lnum>p5</lnum>.js web editor</a>. Here it &nbsn;is:<snr label="prototype">You can also see <a href="https://editor.p5js.org/guillaume/sketches/ej_9eAWxI">this sketch right next to its code</a> in the <lnum>p5</lnum>.js web editor. It will let you easily modify any elements of the sketch and see the results immediately.</snr>
</p>

<div id="dot-grid-demo"></div>

<pn>
    The wall was a good visual anchor for the whole thing considering the title of the musical piece. Even if the dots are moving in smooth oscillations, it's very clear that they are ultimately laid out in a strict grid. I enjoy the tension between those two phenomena, and thought it was a good visual metaphor for the music. The walls are ruminating, contorting themselves into worried thoughts.
</pn>

<h3>Building the software</h3>

<pn>
    <sc>The film</sc> was made entirely by writing custom-made software. The film is itself a program—when this program runs, it either plays the film or renders it to disk. It is distributed as free, open source software, and you can find <a href="https://github.com/pelletierauger/what-the-walls-feel">all the code for it here</a>. You are free to run it, modify it, and distribute modified versions. My work was also greatly inspired by the software <lnum><a href="https://p5js.org/">p5.js</a></lnum>, created by <a href="https://lauren-mccarthy.com/">Lauren McCarthy</a> and her team.
</pn>
<p>
    To write the film, I used another software that I’m currently writing, called Les environs (French for &nbsn;<i>The Surroundings</i>).<snl label="environs">Les environs is also distributed as free software and you can <a href="https://github.com/pelletierauger/Les-environs">download it here</a>.</snl> Les environs is a live coding environment&mdash;it allows to write and modify a program while it is running. It was first designed for the live performance of animation and music. I used it in a few group concerts in Montréal in 2019. Adapting this performative tool for the needs of a film production was a really interesting challenge. I ended up building various modules for all steps of the production: animation, editing, coloration, compositing, rendering.
</p>
<p>
    Below is what the software looks like when I work on the video.
</p>

<img class="full-size-image" src="../../../images/what-the-walls-feel/environment.jpg">

<pn>
    The frame of the film covers most the screen, and a portion of the code is superimposed over it (the code can easily be hidden to reveal the entire image). Near the bottom right of the screen sits the timeline, where all scenes appear as a succession of white and light grey bars. Along the bottom edge are the tabs, which determine what portion of the code is currently displayed. The code can be modified while the film is running, and it affects the film immediately. For example, while the timeline is visually represented, it can only be modified with the code, and changing the length of a scene in the code will automatically update the visual timeline. It’s also possible to zoom into smaller sections of the timeline, still using text commands.
</pn>

<!-- It allowed me to, for example, have my film play in real time while I was working on it, and being able to swap effects and change the timing of scenes while there were running was infinitely more pleasing than what I was previously able to do with After Effects, where all animations needed to "preview to RAM" before they could play. Because my software prepares everything to be calculated by the graphics card, it is a lot faster. -->

<h3>Coloration research</h3>

<pn>
    <sc>One of my favourite</sc> enhancement that I made to my system for this project was the possibility of blending multiple image layers using various blending functions&mdash;the typical blending functions found in Photoshop and After Effects (multiply, add, soft light, &nbsn;etc.).<snl label="filter-graph">More precisely, my system doesn’t rely on linear stacks of layers like Photoshop or After Effects. It can instead be non-linear <i8>graphs of layers</i8>, or <i8>networks of layers</i8>. Story time: my first experience putting an animation film together was made with the antique software USAnimation by Toon Boom. In <a href="https://www.awn.com/animationworld/usanimation-action">this 2001 <sc8>awn</sc8> article</a>, a screenshot of USAnimation's &ldquo;Camera module&rdquo; shows how it relied on this powerful idea of graphs of layers. After transitioning to After Effects a long time ago, I always felt limited by the restrictive system of linear stacks of layers. It is quite a joy to finally go back to graphs.</snl> I found a replica of these blending functions on a <a href="https://mouaif.wordpress.com/2009/01/05/photoshop-math-with-glsl-shaders/">very helpful blog post from 2009</a>, and because this code is distributed as free, open source software, it was possible for me to integrate it to my system. My layer system currently doesn’t exist in a visual form, so putting several layers together is done strictly via coding, and you have to imagine the layer order in your mind.
</pn>
<p>
    This improved system of layers was very useful during the coloration research, which ended up being quite extensive. Below are some examples of this research. My research tended to lead me towards bright and joyous colours because I enjoy them a lot, but they did not fit the tone of the piece of music at all. The music needed a quieter, somber, sadder palette.
</p>
<p>
    I also experimented a lot with colour transitions from scene to scene, but that did not work either. The musical colour of Frank’s piece is so steady and finds so much of its force and its character in this unchanging, unrelenting stubbornness, that introducing a new colour palette at any point in the film felt completely unearned—it felt like the image simply drifted away from the music, exactly the opposite of what I wanted. It also felt like I was simply trying to cram more pretty colours in the film, which is indeed what was happening.
</p>

<img class="full-size-image" src="../../../images/what-the-walls-feel/spicy-lemon-a.jpg">
<img class="full-size-image" src="../../../images/what-the-walls-feel/spicy-lemon-b.jpg">
<img class="full-size-image" src="../../../images/what-the-walls-feel/mustard.jpg">
<img class="full-size-image" src="../../../images/what-the-walls-feel/red-and-blue.jpg">
<img class="full-size-image" src="../../../images/what-the-walls-feel/mustard-muscles.jpg">

<h3>The mathematics behind the film</h3>

<pn>
    <sc>The system</sc> on which the whole film is built is a two-dimensional grid of dots, with an <im>x</im> horizontal axis and a <im>y</im> vertical axis. Each dot occupies one cell within the grid. For example, the dot at the top left has a position of <im>x = 0, y = 0</im>.
</pn>

<img class="inline-image" src="../../../images/what-the-walls-feel/grid.png">

<pn>
    Each dot in this grid is able to move in space. Its initial position in space is defined by the <im>x</im> and <im>y</im> values of the cell in which it is contained. But then, the dot's final position <im>p</im> is calculated by applying a mathematical transformation, which is usually a parametric equation. As an example, here is the transformation that was applied on the animation seen above in this article.
</pn>

<math>
\begin{align*}
    m   &= x \cdot y \cdot 10^{-3} + t\\
    p_x &= x + \cos(m)\\
    p_y &= y + \sin(m)
\end{align*}
</math>

<pn>
    An identical copy of this equation is sent to all the dots, but because each dot has a different <im>x</im> and <im>y</im> value within the grid, the result of the equation is different for each dot. So this equation has three inputs: <im>x</im>, <im>y</im>, and <im>t</im>. The <im>x</im> and <im>y</im> values are the position of the dot within the two-dimensional grid. The third value, <im>t</im>, is the <i>moment in time</i>. It is a value that starts at <im>0</im> when the animation begins and it is simply incremented on each frame of animation. In this case, it is incremented by <im>\pi / 60</im>, an arbitrary number that I chose after trying different numbers and figuring how at which speed the animation was the most interesting to &nbsn;watch.<snl label="arbitrary">I find it interesting to point out the amount of arbitrary decisions that are taken in the design of such systems, because I remember when I was starting out a few years ago, looking at other people's code, I was often under the impression that all parameters of any given system were chosen for some mystical reasons that were out of my grasp, while really, most of this is trying out a ton of different values and slowly approaching what <i8>looks the nicest to you</i8>. In this case, <im>\pi / 60</im> also means that this function will start repeating itself every <im>120</im> frames, since the sine and cosine functions repeat themselves over <im>2\pi</im>.</snl> The <im>t</im> value is identical for each dot&mdash;time goes forward at the same speed for all dots.
</pn>
<p>
    So once this formula is calculated for each dot, the <im>p_x</im> and <im>p_y</im> values of each dot will determine its exact position in space. Note that any dot can fly <i>outside</i> of its origin cell&mdash;the cell's purpose is to give its dot an initial position, not to constrain the dots&rsquo; movements within bounds.
</p>

<h3>Endless variations</h3>

<pn>
    <sc>What I enjoyed</sc> about this system when I started to play with it is the implied infinity of variations that it can produce. By changing any parameters from the formula, but more importantly by writing entirely different formulas, I could get an infinite amount of different choreographies of dots.
</pn>
<p>
    For example, the equation below gave me a very big surprise. The resulting animation doesn't look like a pattern of oscillation anymore. It looks like it was generated by a complicated algorithm that moves data around.
</p>


<!-- let xx = x + pow(cos(y * 0.5 + t * 0.025), 700) * y * x * 200.5; -->
<!-- let yy = y + pow(sin(x * 0.5 + t * 0.025), 700) * y * x * 200.5; -->

<math>
\begin{align*}
    m   &= x \cdot y \cdot 200.5\\
    p_x &= x + m \cdot \cos\bigg(\frac{y}{2} + \frac{t}{40}\bigg)^{700}\\
    p_y &= y + m \cdot \sin\bigg(\frac{x}{2} + \frac{t}{40}\bigg)^{700}
\end{align*}
</math>

<pn>
    This is the equation used in the opening scene of the video, where the dots all move in straight lines, resembling cars stuck in traffic.
</pn>

<h3>Closing thoughts</h3>

<pn>
    <sc>Responding to Frank’s music</sc> with my animations was an inspiring project to undertake. And getting the opportunity to work more on building my animation software was quite a gift: I ended up with results that I could not have expected when the project started. There are millions of ways in which my current system could be improved. I hope to get the opportunity to keep this work going.
</pn>